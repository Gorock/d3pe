<!DOCTYPE html>
<header>
<script src="d3.min.js"></script>
<script src="plot.min.js"></script>
<!-- <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
<script src="https://cdn.jsdelivr.net/npm/@observablehq/plot@0.6"></script> -->
</header>

<body>
<div id="myplot"></div>
<div id="myplot2"></div>

<script type="module">
const data = await d3.csv("market-stock.csv", (row) => {
    return {
        time: new Date(row.time),
        resource: row.resource,
        ammount: +row.ammount
    }
})
console.log(data)
const div = document.querySelector("#myplot");
const div2 = document.querySelector("#myplot2");

const plot  = Plot.plot({
  x: {axis: null},
  y: {tickFormat: "s", grid: true},
  color: {scheme: "spectral", legend: true},
  marks: [
    Plot.barY(data, {
      x: "resource",
      y: "ammount",
      fill: "resource",
      fx: "time",
      sort: {x: null, color: null, fx: {value: "-y", reduce: "sum"}},
      tip: true
    }),
    Plot.ruleY([0])
  ]
})


const plot2  = Plot.plot({
    grid: true,
    nice: true,
  marks: [
    Plot.ruleY([0]),
    Plot.lineY(data, {x: "time", y: "ammount", stroke: "resource", tip: "x"}),
    Plot.text(data, Plot.selectLast({x: "time", y: "ammount", z: "resource", text: "resource", textAnchor: "start", dx: 3})),
    Plot.axisX(),
    Plot.axisY({ticks: 50, text: null, tickSize: 3}),   
    Plot.axisY()

  ]
})







div.append(plot);
div2.append(plot2);

</script>










</body>